import React, { useState, useEffect } from "react";

export default function VocabGame() {
  const vocab = [
    {
      word: "Pervasive",
      definition: "Spreading widely throughout an area or group of people.",
      sentences: [
        "The influence of technology is so ___ that it's hard to imagine life without it.",
        "A ___ sense of optimism filled the city after the announcement.",
        "Corruption had become ___ in the system, affecting even the most honest officials.",
      ],
    },
    {
      word: "Elated",
      definition: "Extremely happy or proud; in high spirits.",
      sentences: [
        "She was ___ after hearing she had been accepted into her dream school.",
        "The team felt ___ as they lifted the trophy in celebration.",
        "He was ___ by the news of his promotion.",
      ],
    },
    {
      word: "Recant",
      definition: "To formally withdraw or deny a previously held statement or belief.",
      sentences: [
        "Under pressure, the witness chose to ___ his earlier testimony.",
        "The scientist refused to ___ his controversial findings.",
        "He publicly ___ed his previous support for the policy.",
      ],
    },
    {
      word: "Implausibility",
      definition: "The quality of being unlikely or difficult to believe.",
      sentences: [
        "The ___ of his excuse made everyone suspicious.",
        "Despite the story’s ___, it captured the public’s imagination.",
        "Her expression showed disbelief at the sheer ___ of his claim.",
      ],
    },
    {
      word: "Torrent",
      definition: "A strong and fast-moving stream of water or other liquid; a sudden, violent outpouring.",
      sentences: [
        "After the storm, a ___ of water rushed down the hillside.",
        "He unleashed a ___ of words in anger.",
        "The actor faced a ___ of criticism after the scandal.",
      ],
    },
    {
      word: "Contorted",
      definition: "Twisted or bent out of its normal shape.",
      sentences: [
        "His face was ___ with pain as he struggled to stand.",
        "The tree’s branches were ___ by years of harsh wind.",
        "She made a ___ expression after tasting the sour fruit.",
      ],
    },
    {
      word: "Desolation",
      definition: "A state of emptiness, loneliness, or destruction.",
      sentences: [
        "The abandoned town was filled with an eerie sense of ___.",
        "After the fire, only ___ remained where the forest once stood.",
        "He felt a deep ___ after losing his closest friend.",
      ],
    },
  ];

  const [studyMode, setStudyMode] = useState(true);
  const [gameStarted, setGameStarted] = useState(false);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [input, setInput] = useState("");
  const [feedback, setFeedback] = useState("");
  const [score, setScore] = useState(0);
  const [questions, setQuestions] = useState([]);
  const [showDefinition, setShowDefinition] = useState(false);
  const [gameOver, setGameOver] = useState(false);

  function initQuestions() {
    const selected = vocab.map((v) => {
      const randomSentence = v.sentences[Math.floor(Math.random() * v.sentences.length)];
      return { ...v, sentence: randomSentence };
    });
    for (let i = selected.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [selected[i], selected[j]] = [selected[j], selected[i]];
    }
    setQuestions(selected);
    setCurrentIndex(0);
    setInput("");
    setFeedback("");
    setScore(0);
    setShowDefinition(false);
    setGameOver(false);
    setGameStarted(false);
    setStudyMode(true);
  }

  useEffect(() => {
    initQuestions();
  }, []);

  const startGame = () => {
    setStudyMode(false);
    setGameStarted(true);
    setCurrentIndex(0);
    setInput("");
    setFeedback("");
    setScore(0);
    setShowDefinition(false);
    setGameOver(false);
  };

  const handleSubmit = () => {
    if (!questions || questions.length === 0) return;
    const currentWord = questions[currentIndex].word.toLowerCase();
    if (input.trim().toLowerCase() === currentWord) {
      setFeedback("✅ Correct!");
      setScore((s) => s + 1);
    } else {
      setFeedback(`❌ Incorrect. The word was ${questions[currentIndex].word}.`);
    }
    setShowDefinition(true);
  };

  const nextQuestion = () => {
    setInput("");
    setFeedback("");
    setShowDefinition(false);
    if (currentIndex + 1 < questions.length) {
      setCurrentIndex((i) => i + 1);
    } else {
      setGameOver(true);
      setGameStarted(false);
    }
  };

  const restartGame = () => {
    initQuestions();
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-amber-100 to-orange-200 text-brown-800 p-6 font-serif">
      <div className="max-w-3xl bg-amber-50 rounded-2xl shadow-lg p-8 border border-amber-300">
        <h1 className="text-4xl font-bold text-center text-amber-900 mb-6">Vocab Challenge</h1>

        {studyMode && (
          <div>
            <h2 className="text-2xl font-semibold mb-4 text-amber-800">Study Mode</h2>
            {vocab.map((v, i) => (
              <div key={i} className="mb-4 p-4 bg-amber-100 rounded-xl border border-amber-300">
                <strong className="text-amber-900">{v.word}</strong>: {v.definition}
              </div>
            ))}
            <button
              onClick={() => startGame()}
              className="mt-4 bg-amber-700 hover:bg-amber-800 text-white px-5 py-2 rounded-xl shadow-md"
            >
              Start Game
            </button>
          </div>
        )}

        {gameStarted && !gameOver && questions.length > 0 && (
          <div className="text-center">
            <p className="mb-6 text-xl">
              {questions[currentIndex].sentence.split("___").map((part, i) => (
                <React.Fragment key={i}>
                  {part}
                  {i === 0 && (
                    <input
                      type="text"
                      value={input}
                      onChange={(e) => setInput(e.target.value)}
                      className="border-b-2 border-amber-700 focus:outline-none bg-transparent text-center text-lg mx-2 w-40"
                      placeholder="..."
                    />
                  )}
                </React.Fragment>
              ))}
            </p>

            <button
              onClick={handleSubmit}
              className="bg-amber-600 hover:bg-amber-700 text-white px-5 py-2 rounded-xl shadow-md m-2"
            >
              Submit
            </button>

            {feedback && <p className="mt-4 text-lg">{feedback}</p>}
            {showDefinition && (
              <p className="italic text-amber-900 mt-2 transition-opacity duration-500">
                {questions[currentIndex].definition}
              </p>
            )}

            {showDefinition && (
              <button
                onClick={nextQuestion}
                className="mt-4 bg-amber-700 hover:bg-amber-800 text-white px-4 py-2 rounded-xl"
              >
                Next
              </button>
            )}
          </div>
        )}

        {gameOver && (
          <div className="text-center">
            <h2 className="text-2xl font-semibold text-amber-900 mb-4">Game Over!</h2>
            <p className="text-lg mb-2">Your Score: {score}/{questions.length}</p>
            <button
              onClick={restartGame}
              className="bg-amber-700 hover:bg-amber-800 text-white px-5 py-2 rounded-xl shadow-md"
            >
              Restart
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
